<?xml version="1.0" encoding="UTF-8"?>

<config scriptlang="default_script_lang">

	<var-def name="cityNamesOut">
	</var-def>
	
	<var-def name="cityLatitudesOut">
	</var-def>
	
	<var-def name="cityLongitudesOut">
	</var-def>
	
	<var-def name="cityImagesOut">
	</var-def>
	
	<var-def name="cityDescriptionsOut">
	</var-def>

	<script language="javascript">
		cityNames =  new Array();
		cityImages = new Array();
		cityLatitudes = new Array();
		cityLongitudes = new Array();
		cityDescriptions = new Array();
	</script>

	<loop item="link" index="i" filter="unique">

		<list>
			<var-def name="URLlist">
				<tokenize>
					<file action="read" path="${inputFile}">
					</file>
				</tokenize>
			</var-def>
		</list>
		
		<body>
			<var-def name="loadedData">
					<html-to-xml outputtype="pretty">
					    <http url="${link}"/>
					</html-to-xml>		
			</var-def>
			
			<var-def name="currentCityName">
					<xpath expression="//h1">
						<var name="loadedData"/>
					</xpath>	
			</var-def>
			
			<var-def name="currentCityImage">
					<xpath expression="//a[@title='Флаг']/img">
						<var name="loadedData"/>
					</xpath>	
			</var-def>
			
			<var-def name="currentCityLatitude">
					<xpath expression="//span[@class='geo-dms']/span[@class='geo-lat']">
						<var name="loadedData"/>
					</xpath>	
			</var-def>
			
			<var-def name="currentCityLongitude">
					<xpath expression="//span[@class='geo-dms']/span[@class='geo-lon']">
						<var name="loadedData"/>
					</xpath>	
			</var-def>
			
			<var-def name="currentCityDescription1">
				<xpath expression="//div[@id='bodyContent']/p[1]">
						<var name="loadedData"/>
					</xpath>	
			</var-def>
			
			<var-def name="currentCityDescription2">
				<xpath expression="//div[@id='bodyContent']/p[2]">
						<var name="loadedData"/>
					</xpath>	
			</var-def>
			
			
			<script language="javascript">
				cityNames.push(currentCityName.toString());
				cityImages.push(currentCityImage.toString().replace("\n"," "));
				cityLatitudes.push(currentCityLatitude.toString());
				cityLongitudes.push(currentCityLongitude.toString());
				cityDescriptions.push(currentCityDescription1.toString().replace("\n"," "));
				cityDescriptions.push(currentCityDescription2.toString().replace("\n"," "));
			</script>			
			
		</body>
	</loop>
	
	<script language="javascript">
		sys.defineVariable("cityNamesOut", cityNames.join('\n'), true);
		sys.defineVariable("cityImagesOut", cityImages.join('\n'), true);
		sys.defineVariable("cityLatitudesOut", cityLatitudes.join('\n'), true);
		sys.defineVariable("cityLongitudesOut", cityLongitudes.join('\n'), true);
		sys.defineVariable("cityDescriptionsOut", cityDescriptions.join('\n'), true);
	</script>
	
</config>